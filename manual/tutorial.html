<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Tutorial</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container manual-root" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/popcorn-official/popcorn-api.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual" data-toc-name="overview">
    <h1 class="manual-toc-title"><a href="manual/overview.html" data-ice="title">Overview</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/overview.html#overview" data-ice="link">Overview</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/overview.html#documentation" data-ice="link">Documentation</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/overview.html#folder-structure" data-ice="link">Folder structure</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/overview.html#versioning" data-ice="link">Versioning</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/overview.html#license" data-ice="link">License</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="installation">
    <h1 class="manual-toc-title"><a href="manual/installation.html" data-ice="title">Installation</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/installation.html#installation" data-ice="link">Installation</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="tutorial">
    <h1 class="manual-toc-title"><a href="manual/tutorial.html" data-ice="title">Tutorial</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/tutorial.html#tutorial" data-ice="link">Tutorial</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/tutorial.html#scraper" data-ice="link">Scraper</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/tutorial.html#content-providers" data-ice="link">Content Providers</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/tutorial.html#eztv" data-ice="link">EZTV</a></li>
<li data-ice="manualNav" class="indent-h4"><span class="manual-dot"></span><a href="manual/tutorial.html#getallshows" data-ice="link">getAllShows</a></li>
<li data-ice="manualNav" class="indent-h4"><span class="manual-dot"></span><a href="manual/tutorial.html#getshowdata" data-ice="link">getShowData</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/tutorial.html#horriblesubs" data-ice="link">Horriblesubs</a></li>
<li data-ice="manualNav" class="indent-h4"><span class="manual-dot"></span><a href="manual/tutorial.html#getallanime" data-ice="link">getAllAnime</a></li>
<li data-ice="manualNav" class="indent-h4"><span class="manual-dot"></span><a href="manual/tutorial.html#getanimedata" data-ice="link">getAnimeData</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/tutorial.html#kat" data-ice="link">KAT</a></li>
<li data-ice="manualNav" class="indent-h4"><span class="manual-dot"></span><a href="manual/tutorial.html#anime" data-ice="link">Anime</a></li>
<li data-ice="manualNav" class="indent-h4"><span class="manual-dot"></span><a href="manual/tutorial.html#movie" data-ice="link">Movie</a></li>
<li data-ice="manualNav" class="indent-h4"><span class="manual-dot"></span><a href="manual/tutorial.html#show" data-ice="link">Show</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/tutorial.html#yts" data-ice="link">YTS</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/tutorial.html#helpers" data-ice="link">Helpers</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/tutorial.html#anime-show" data-ice="link">Anime &amp; Show</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/tutorial.html#movie" data-ice="link">Movie</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/tutorial.html#metadata-providers" data-ice="link">Metadata Providers</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/tutorial.html#trakt-tv" data-ice="link">Trakt.tv</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/tutorial.html#hummingbird-me" data-ice="link">Hummingbird.me</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="usage">
    <h1 class="manual-toc-title"><a href="manual/usage.html" data-ice="title">Usage</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/usage.html#usage" data-ice="link">Usage</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/usage.html#npm" data-ice="link">npm</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/usage.html#gulp" data-ice="link">Gulp</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/usage.html#global" data-ice="link">Global</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="example">
    <h1 class="manual-toc-title"><a href="manual/example.html" data-ice="title">Example</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/example.html#example" data-ice="link">Example</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/example.html#index" data-ice="link">Index</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/example.html#logs" data-ice="link">Logs</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/example.html#export" data-ice="link">Export</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/example.html#anime" data-ice="link">Anime</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/example.html#movie" data-ice="link">Movie</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/example.html#show" data-ice="link">Show</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/example.html#query-strings" data-ice="link">Query strings</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/example.html#sorting" data-ice="link">Sorting</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/example.html#ordering" data-ice="link">Ordering</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/example.html#genres" data-ice="link">Genres</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/example.html#movies-shows" data-ice="link">Movies &amp; Shows</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/example.html#anime" data-ice="link">Anime</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/example.html#keywords" data-ice="link">Keywords</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="reference">
    <h1 class="manual-toc-title"><a href="identifiers.html" data-ice="title">Reference</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="identifiers.html#class" data-ice="link">Class</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="identifiers.html#variable" data-ice="link">Variable</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="changelog">
    <h1 class="manual-toc-title"><a href="manual/changelog.html" data-ice="title">Changelog</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/changelog.html#2-1-0-you-weeaboos-2-august-2016" data-ice="link">2.1.0 - You weeaboos - 2 August 2016</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/changelog.html#2-0-0-whatcha-babbling-about-20-june-2016" data-ice="link">2.0.0 - Whatcha Babbling about? - 20 June 2016</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/changelog.html#1-1-0-wanna-catch-a-movie-20-march-2016" data-ice="link">1.1.0 - Wanna catch a movie? - 20 March 2016</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/changelog.html#1-0-2-wanna-retry-14-march-2016" data-ice="link">1.0.2 - Wanna retry? - 14 March 2016</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/changelog.html#1-0-1-what-s-trending-6-march-2016" data-ice="link">1.0.1 - What&apos;s trending? - 6 March 2016</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/changelog.html#1-0-0-let-s-kick-some-ass-1-march-2016" data-ice="link">1.0.0 - Let&apos;s kick some ass! - 1 March 2016</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown">
  <div class="manual-breadcrumb-list">
    <a href="./manual/./index.html">Manual</a>
    <span>&#xBB;</span>
    <span data-ice="title">Tutorial</span>
  </div>
  <div data-ice="content"><h1 id="tutorial">Tutorial</h1>
<p>In this tutorial section you can read about the scraping process of the API.</p>
<h2 id="scraper">Scraper</h2>
<p>The <a href="https://popcorn-official.github.io/popcorn-api/class/src/scraper.js~Scraper.html"><code>Scraper</code></a> class is the entry point to start the scraping process with the <a href="https://popcorn-official.github.io/popcorn-api/class/src/scraper.js~Scraper.html#instance-method-scrape"><code>scrape</code></a> method. This method will iterate through an array of methods to scrape each individual content provider.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">scrape() {
  Scraper._util.setLastUpdated();

  asyncq.eachSeries([
    this._scrapeEZTVShows,
    this._scrapeKATShows,
    this._scrapeYTSMovies,
    this._scrapeKATMovies,
    this._scrapeHorribelSubsAnime,
    this._scrapeKATAnime
  ], scraper =&gt; scraper()).then(value =&gt; Scraper._util.setStatus())
    .catch(err =&gt; Scraper._util.onError(`Error while scraping: ${err}`));
};</code>
</code></pre>
<h2 id="content-providers">Content Providers</h2>
<p>Popcorn API gets its torrent content from various sources. Here you can see where the content is coming from.</p>
<table>
<thead>
<tr>
<th></th>
<th>Anime</th>
<th>Movie</th>
<th>Show</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://eztv.ag/">EZTV</a></td>
<td></td>
<td></td>
<td>X</td>
</tr>
<tr>
<td><a href="https://horriblesubs.info/">Horriblesubs</a></td>
<td>X</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="https://kat.cr/">KAT</a></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><a href="https://yts.ag/">YTS</a></td>
<td></td>
<td>X</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="eztv">EZTV</h3>
<p>Content from <a href="https://eztv.ag/">eztv.ag</a> is grabbed through the <a href="https://github.com/ChrisAlderson/eztv-api-pt">eztv-api-pt</a> module. The module contains two methods <code>getAllShows</code> and <code>getShowData</code>.</p>
<h4 id="getallshows">getAllShows</h4>
<p>This method returns a list of all the available shows listed <a href="https://eztv.ag/showlist/">here</a>. Through regular expression it grabs the show title, the id used by <a href="https://eztv.ag/">eztv</a> and the slug.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">[{
    show: &quot;10 O\&quot;Clock Live&quot;,
    id: &quot;449&quot;,
    slug: &quot;10-o-clock-live&quot;
  }, {
    show: &quot;10 Things I Hate About You&quot;,
    id: &quot;308&quot;,
    slug: &quot;10-things-i-hate-about-you&quot;
  },
  ...
]</code>
</code></pre>
<h4 id="getshowdata">getShowData</h4>
<p>Each show from the <code>getAllShows</code> can be passed into the <code>getShowData</code> method to get more data on the individual show. Through this process the slug can change to another slug or imdb id which is compatible with <a href="https://trakt.tv/">Trakt.tv</a>. Torrents are being added to the <code>episodes</code> property which is compatible with the <a href="#helpers">helper</a> to insert the torrents into the MongoDB database. Nested within the <code>episodes</code> property there is the <code>season number</code> within the <code>season number</code> is the <code>episode number</code> and within the <code>episode number</code> are the different <code>qualities</code> of the torrent.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">{ show: &quot;10 O\&apos;Clock Live&quot;,
  id: &quot;449&quot;,
  slug: &quot;tt1811399&quot;,
  episodes:
   { &quot;1&quot;:
      { &quot;1&quot;:
         { &quot;480p&quot;:
            { url: &quot;magnet:?xt=urn:btih:LMJXHHNOW33Z3YGXJLCTJZ23WK2D6VO4&amp;dn=10.OClock.Live.S01E01.WS.PDTV.XviD-PVR&amp;tr=udp://tracker.openbittorrent.com:80&amp;tr=udp://open.demonii.com:80&amp;tr=udp://tracker.coppersurfer.tk:80&amp;tr=udp://tracker.leechers-paradise.org:6969&amp;tr=udp://exodus.desync.com:6969&quot;,
              seeds: 0,
              peers: 0,
              provider: &quot;EZTV&quot; } },
        ...
      }
    }
}</code>
</code></pre>
<h3 id="horriblesubs">Horriblesubs</h3>
<p>Content from <a href="https://horriblesubs.info/">horriblesubs.info</a> is grabbed through the <a href="https://github.com/ChrisAlderson/horriblesubs-api">horriblesubs-api</a> module. The module contains two methods <code>getAllAnime</code> and <code>getAnimeData</code>. This module is based on <a href="https://github.com/ChrisAlderson/eztv-api-pt">eztv-api-pt</a> module and the usage of the module within the API is very similar to the <a href="#eztv">EZTV provider</a>.</p>
<h4 id="getallanime">getAllAnime</h4>
<p>This method returns a list of all the available shows listed <a href="http://horriblesubs.info/shows/">here</a>. Through the <a href="https://github.com/cheeriojs/cheerio">cheerio</a> module it grabs the anime title, the slug, and the link to get more details about the anime.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">[{
  link: &quot;/shows/91-days&quot;,
  slug: &quot;91-days&quot;,
  title: &quot;91 Days&quot;
}, {
  link: &quot;/shows/absolute-duo&quot;,
  slug: &quot;absolute-duo&quot;,
  title: &quot;Absolute Duo&quot;
}, ...]</code>
</code></pre>
<h4 id="getanimedata">getAnimeData</h4>
<p>Each anime from the <code>getAllAnime</code> can be passed into the <code>getAnimeData</code> method to get more data on the individual anime. Through this process the slug can change to another slug which is compatible with <a href="https://hummingbird.me">Hummingbird.me</a>. The <code>hs_showid</code> is added and torrents are being added to the <code>episodes</code> property which is compatible with the <a href="#helpers">helper</a> to insert the torrents into the MongoDB database. Nested within the <code>episodes</code> property there is the <code>season number</code> within the <code>season number</code> is the <code>episode number</code> and within the <code>episode number</code> are the different <code>qualities</code> of the torrent.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">{ link: &quot;/shows/91-days&quot;,
  slug: &quot;ninety-one-days&quot;,
  title: &quot;91 Days&quot;,
  hs_showid: &quot;731&quot;,
  episodes:
   { &quot;1&quot;:
      { &quot;1&quot;:
        { &quot;480&quot;:
          { url: &quot;magnet:?xt=urn:btih:AYIJKPLP5WVVF36O25JBB3FFPNJEBBPQ&amp;tr=http://open.nyaatorrents.info:6544/announce&amp;tr=udp://tracker.openbittorrent.com:80/announce&amp;tr=udp://tracker.coppersurfer.tk:6969/announce&quot;,
          seeds: 0,
          peers: 0,
          provider: &quot;HorribleSubs&quot; } },
        ...
      }
    }
}</code>
</code></pre>
<h3 id="kat">KAT</h3>
<p>Content from <a href="https://kat.cr/">kat.cr</a> is grabbed with so called <code>providers</code> which are defined in the
 <a href="https://popcorn-official.github.io/popcorn-api/variable/index.html#static-variable-animeProviders"><code>animeProviders</code></a>, <a href="https://popcorn-official.github.io/popcorn-api/variable/index.html#static-variable-movieProviders"><code>movieProviders</code></a> and <a href="https://popcorn-official.github.io/popcorn-api/variable/index.html#static-variable-showProviders"><code>showProviders</code></a> arrays. Providers will be converted to a search query to <a href="https://kat.cr/">kat.cr</a> so each provider can get a maximum of 10.000 torrents (or 400 pages or torrents). The module used for getting the data from <a href="https://kat.cr/">kat.cr</a> can be found <a href="https://github.com/chrisalderson/kat-api-pt">here</a>.</p>
<p>Each provider needs a <code>name</code> property and a <code>query</code> property. The <code>name</code> property is a <code>String</code> will be used for logging purposes so that issues with the provider can be figured out easier. The <code>query</code> property is an <code>Object</code> which can contain various properties. These properties will be converted into a search query to <a href="https://kat.cr/">kat.cr</a>.</p>
<p>The following <code>query</code> properties can be used:</p>
<pre><code><code class="source-code prettyprint"> - query               # Search for keywords
 - category            # The category to search for e.g. tv or movies
 - uploader            # The name of the uploader of the torrents
 - min_seeds           # The minimum amount of seeds
 - age                 # The age of the torrents
 - min_files           # The minimum amount of files
 - imdb                # The imdb id for a tv show (only works with category:tv)
 - tvrage              # The tvrage id for a tv show (only works with category:tv)
 - language            # The language of the movie/tv show e.g. en or pl
 - adult_filter        # Filter out the adult torrents
 - verified            # Show only the verified torrents
 - season              # Season number of a tv show (only works with category:tv)
 - episode             # Episode number of a tv show (only works with category:tv)
 - page                # The page to search on.
 - sort_by             # Sort by property
 - order               # Order the list asc or desc</code>
</code></pre><p>All three types of content can be scraped from <a href="https://kat.cr/">kat.cr</a> through the <code>KAT</code> class in each folder of the providers. By default the <code>KAT</code> class add a few default properties to the providers. The <code>page</code> property does not need to be indicated since the algorithm for scraping <a href="https://kat.cr/">kat.cr</a> will go through all the available pages (max of 400 due to site limitations). The <code>adult_filter</code> and <code>verified</code> properties are also turned on by default to filter out the bad content. The <code>category</code> property is filled in for each type of content. For <code>anime</code> it is <code>english-translated</code>, the <code>movies</code> category is <code>movies</code> and for <code>shows</code> there is <code>tv</code>. Lastly the <code>movies</code> need a <code>language</code> property otherwise the scraper will throw an error and the <code>shows</code> will have a default <code>language</code> as <code>en</code> so only English TV shows will be filtered.</p>
<p><strong>An example of a provider:</strong></p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">{
  name: &quot;ZonerLOL&quot;,
  query: {
    query: &quot;x264-LOL&quot;,
    min_seeds: 3
  }
}</code>
</code></pre>
<p>If you want to make a provider for <a href="https://kat.cr/">kat.cr</a> it is highly recommended you try it fist in the browser by manually going to <a href="https://kat.cr/">kat.cr</a> and search for the content. This is because the title of the torrent will be subjected to regular expressions to grab the needed data for the <a href="#helpers">helper</a> to insert the torrents into the MongoDB database.</p>
<h4 id="anime">Anime</h4>
<p><strong>NOTE:</strong> the KAT content provider was written just before the <a href="https://kat.cr/">kat.cr</a> was taken down. This is why there are only two regular expression and those are for Horriblesubs. These regular expressions are redundant because of the <a href="#horriblesubs">Horriblesubs</a> provider.</p>
<p>The regular expression needs to get a <code>title</code>, <code>episode</code> and a <code>quality</code> property. A <code>season</code> property is optional, if the <code>season</code> is not in the episode title it will assume the torrent is from <code>season</code> 1. Down below you can see the method to get the needed data for an anime episode. If your content does not match any of these regular expressions, you can add the regular expression to the method.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">_getAnimeData(torrent) {
  const secondSeason = /\[horriblesubs\].(.*).S(\d)...(\d{2,3}).\[(\d{3,4}p)\]/i; // [HorribleSubs] Fairy Tail S2 - 70 [1080p].mkv
  const oneSeason = /\[horriblesubs\].(.*)...(\d{2,3}).\[(\d{3,4}p)\]/i // [HorribleSubs] Gangsta - 06 [480p].mkv
  if (torrent.title.match(secondSeason)) {
    return this._extractAnime(torrent, secondSeason);
  } else if (torrent.title.match(oneSeason) {
    return this._extractAnime(torrent, oneSeason);
  } else {
    console.warn(`${this.name}: Could not find data from torrent: &apos;${torrent.title}&apos;`);
  }
};</code>
</code></pre>
<h4 id="movie">Movie</h4>
<p>The regular expression for movies needs to get a <code>title</code>, <code>year</code> and a <code>quality</code> property. Down below you can see the method to get the needed data for a movie. If your content does not match any of these regular expressions, you can add the regular expression to the method.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">_getMovieData(torrent, language) {
  const threeDimensions = /(.*).(\d{4}).[3Dd]\D+(\d{3,4}p)/; // Journey to Space 2015 3D 1080p BRRip Half-SBS x264 AAC-ETRG
  const fourKay = /(.*).(\d{4}).[4k]\D+(\d{3,4}p)/; // Spider Man 2002 4K REMASTERED Bluray 1080p TrueHD x264-Grym
  const withYear = /(.*).(\d{4})\D+(\d{3,4}p)/; // Batman Begins 2005 720p BluRay x264 AC3 - Ozlem
  if (torrent.title.match(threeDimensions)) {
    return this._extractMovie(torrent, language, threeDimensions);
  } else if (torrent.title.match(fourKay)) {
    return this._extractMovie(torrent, language, fourKay);
  } else if (torrent.title.match(withYear)) {
    return this._extractMovie(torrent, language, withYear);
  } else {
    console.warn(`${this.name}: Could not find data from torrent: &apos;${torrent.title}&apos;`);
  }
};</code>
</code></pre>
<h4 id="show">Show</h4>
<p>The regular expression for shows needs to get a <code>title</code>, <code>season</code>, <code>episode</code> and a <code>quality</code> property. Down below you can see the method to get the needed data for a show episode. If your content does not match any of these regular expressions, you can add the regular expression to the method.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">_getShowData(torrent) {
  const seasonBased = /(.*).[sS](\d{2})[eE](\d{2})/; // Dexter S08E09 720p HDTV x264-IMMERSE
  const vtv = /(.*).(\d{1,2})[x](\d{2})/; // The Whispers 1x09 (HDTV-x264-KILLERS)[VTV]
  const dateBased = /(.*).(\d{4}).(\d{2}.\d{2})/; // Jimmy Fallon 2016 08 02 Jonah Hill HDTV x264-CROOKS
  if (torrent.title.match(seasonBased)) {
    return this._extractShow(torrent, seasonBased, false);
  } else if (torrent.title.match(vtv)) {
    return this._extractShow(torrent, vtv, false);
  } else if (torrent.title.match(dateBased)) {
    return this._extractShow(torrent, dateBased, true);
  } else {
    console.warn(`${this.name}: Could not find data from torrent: &apos;${torrent.title}&apos;`);
  }
};</code>
</code></pre>
<h3 id="yts">YTS</h3>
<p><strong>NOTE:</strong> This provider will most likely be changed to use a YTS API wrapper module. No API wrappers exists for YTS which are using promises, so one needs to be made.</p>
<h2 id="helpers">Helpers</h2>
<p>The <code>helper.js</code> classes in each provider folder helps the providers to insert the scraped data into the MongoDB database. The providers need to call two methods.</p>
<h3 id="anime-show">Anime &amp; Show</h3>
<p>The first method to call is <a href="https://popcorn-official.github.io/popcorn-api/class/src/providers/anime/helper.js~Helper.html#instance-method-getHummingbirdInfo"><code>getHummingbirdInfo</code></a> for anime and <a href="https://popcorn-official.github.io/popcorn-api/class/src/providers/show/helper.js~Helper.html#instance-method-getTraktInfo"><code>getTraktInfo</code></a> for shows. These methods need a slug as a parameter (<a href="https://popcorn-official.github.io/popcorn-api/class/src/providers/show/helper.js~Helper.html#instance-method-getTraktInfo"><code>getTraktInfo</code></a> can also use an imdb id). These methods will fetch metadata from <a href="https://hummingbird.me/">Hummingbird.me</a> or <a href="https://trakt.tv">Trakt.tv</a> and return an object based on the schema of the mongoose model, but without any episodes.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">getTraktInfo(slug);
getHummingbirdInfo(slug);</code>
</code></pre>
<p>The second method to call is the <code>addEpisodes</code> method to attach the episodes to the object returned by <a href="https://popcorn-official.github.io/popcorn-api/class/src/providers/anime/helper.js~Helper.html#instance-method-getHummingbirdInfo"><code>getHummingbirdInfo</code></a> or <a href="https://popcorn-official.github.io/popcorn-api/class/src/providers/anime/helper.js~Helper.html#instance-method-getHummingbirdInfo"><code>getTraktInfo</code></a>. This object is the first parameter, the second one is the episodes object and the third parameter is the slug again.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">addEpisodes(anime/show, episodes, slug);</code>
</code></pre>
<p>The episodes are structured in a particular way. In the episodes object you first have the seasons represented by a number. Nested in each season is another object which is the episode which is also represented by a number. In the episode object you have the qualities available for the episode. These qualities can be <code>480p</code>, <code>720p</code> or <code>1080p</code>. Finally inside the quality object you have the <code>url</code> to the torrent or magnet link, the amount of <code>seeds</code> and <code>peers</code> and lastly the name of the provider.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">{
  &quot;1&quot;: {
    &quot;1&quot;: {
      &quot;480p&quot;: {
        url: &quot;magnet:?xt=urn:btih:LMJXHHNOW33Z3YGXJLCTJZ23WK2D6VO4&amp;dn=10.OClock.Live.S01E01.WS.PDTV.XviD-PVR&amp;tr=udp://tracker.openbittorrent.com:80&amp;tr=udp://open.demonii.com:80&amp;tr=udp://tracker.coppersurfer.tk:80&amp;tr=udp://tracker.leechers-paradise.org:6969&amp;tr=udp://exodus.desync.com:6969&quot;,
        seeds: 0,
        peers: 0,
        provider: &quot;EZTV&quot;
      }
    }
  }
}</code>
</code></pre>
<h3 id="movie">Movie</h3>
<p>The first method to call is <a href="https://popcorn-official.github.io/popcorn-api/class/src/providers/movie/helper.js~Helper.html#instance-method-getTraktInfo"><code>getTraktInfo</code></a>. This method need a slug as a parameter, but can also use an imdb id). This method will fetch metadata from <a href="https://trakt.tv">Trakt.tv</a> and return an object based on the schema of the mongoose model, but without any torrents.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">getTraktInfo(slug);</code>
</code></pre>
<p>The second method to call is the <a href="https://popcorn-official.github.io/popcorn-api/class/src/providers/movie/helper.js~Helper.html#instance-method-addTorrents"><code>addTorrents</code></a> method to attach the torrents to the object returned by <a href="https://popcorn-official.github.io/popcorn-api/class/src/providers/movie/helper.js~Helper.html#instance-method-getTraktInfo"><code>getTraktInfo</code></a>. This object is the first parameter, the second one is the torrents for the movie.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">addTorrents(movie, torrents);</code>
</code></pre>
<p>The torrents are structured in a particular way. In the torrents object you first have the language of the torrents represented by a language code e.g. <code>en</code>. Nested inside the language are the qualities of the torrents. These qualities can be <code>720p</code> or <code>1080p</code>. Finally inside the quality object you have the <code>url</code> to the torrent or magnet link, the amount of <code>seeds</code> and <code>peers</code>, the <code>size</code> of the torrent in bits, the <code>fileSize</code> which is a more easily readable version of <code>size</code> and lastly the name of provider.</p>
<pre><code class="lang-javascipt"><code class="source-code prettyprint">{
  &quot;en&quot;: {
    &quot;720p&quot;: {
      url: &quot;magnet:?xt=urn:btih:1BEA4C992D1F7A765F3C943E627E881AC7FDAA35&amp;tr=udp://glotorrents.pw:6969/announce&amp;tr=udp://tracker.opentrackr.org:1337/announce&amp;tr=udp://torrent.gresille.org:80/announce&amp;tr=udp://tracker.openbittorrent.com:80&amp;tr=udp://tracker.coppersurfer.tk:6969&amp;tr=udp://tracker.leechers-paradise.org:6969&amp;tr=udp://p4p.arenabg.ch:1337&amp;tr=udp://tracker.internetwarriors.net:1337&quot;,
      seed: 156,
      peer: 44,
      size: 819829146,
      filesize: &quot;781.85 MB&quot;,
      provider: &quot;YTS&quot;
    }
  }
}</code>
</code></pre>
<h2 id="metadata-providers">Metadata Providers</h2>
<p>Metadata providers are providers which get data on a movie or get seasonal information from a show. Popcorn API uses two API services to get its metadata on anime, movies and shows.</p>
<h3 id="trakt-tv">Trakt.tv</h3>
<p><a href="https://trakt.tv/">Trakt.tv</a> is the metadata provider for movies and shows. It uses a module from <a href="https://github.com/vankasteelj">Jean van Kasteel</a> called <a href="https://github.com/vankasteelj/trakt.tv">Trakt.tv</a>. For more information about the Trakt API you can click <a href="http://docs.trakt.apiary.io/">here</a>.</p>
<h3 id="hummingbird-me">Hummingbird.me</h3>
<p><a href="https://hummingbird.me">Hummingbird.me</a> is the metadata provider for anime. It uses the <a href="https://github.com/ChrisAlderson/hummingbird-api">hummingbird-api</a> module. For more information about the Hummingbird API you can click <a href="https://github.com/hummingbird-me/hummingbird/wiki">here</a>.</p>
</div>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.7)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
